import{r as e,G as r,X as t,_ as s,f as i,g as o,m as a}from"../nitro/nitro.mjs";import"node:buffer";import"node:process";import"node:events";import"node:timers";import"node:async_hooks";import"node:url";function u(){var e;return o({password:null!=(e=a.env.SESSION_SECRET)?e:"areallylongsecretthatyoushouldreplace"})}const n=e((async function(e){const o=String(e.get("username")),a=String(e.get("password")),n=String(e.get("loginType"));let c=function(e){if("string"!=typeof e||e.length<3)return"Usernames must be at least 3 characters long"}(o)||function(e){if("string"!=typeof e||e.length<6)return"Passwords must be at least 6 characters long"}(a);if(c)return new Error(c);try{const e=await("login"!==n?async function(e,r){if(await t.select().from(s).where(i(s.username,e)).get())throw new Error("User already exists");return t.insert(s).values({username:e,password:r}).returning().get()}(o,a):async function(e,r){const o=await t.select().from(s).where(i(s.username,e)).get();if(!o||r!==o.password)throw new Error("Invalid login");return o}(o,a));await(await u()).update((r=>{r.userId=e.id}))}catch(e){return e}throw r("/")}),"src_api_server_ts--loginOrRegister_1","/Users/Home/Developer/GitHub/solid-start/examples/with-drizzle/src/api/server.ts?tsr-directive-use-server="),c=e((async function(){throw await(await u()).update((e=>e.userId=void 0)),r("/login")}),"src_api_server_ts--logout_1","/Users/Home/Developer/GitHub/solid-start/examples/with-drizzle/src/api/server.ts?tsr-directive-use-server="),l=e((async function(){const e=(await u()).data.userId;if(void 0===e)throw r("/login");try{const o=await t.select().from(s).where(i(s.id,e)).get();if(!o)throw r("/login");return{id:o.id,username:o.username}}catch{throw d()}}),"src_api_server_ts--getUser_1","/Users/Home/Developer/GitHub/solid-start/examples/with-drizzle/src/api/server.ts?tsr-directive-use-server="),d=c;export{l as getUser_1,n as loginOrRegister_1,c as logout_1};
//# sourceMappingURL=server-B-YuvM1W.mjs.map
